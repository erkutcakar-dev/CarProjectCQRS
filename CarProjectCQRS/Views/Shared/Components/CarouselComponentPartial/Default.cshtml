@model CarProjectCQRS.Models.CarouselViewModel

<!-- Carousel Start -->
<div class="header-carousel">
    <div id="carouselId" class="carousel slide" data-bs-ride="carousel" data-bs-interval="false">
        <ol class="carousel-indicators">
            <li data-bs-target="#carouselId" data-bs-slide-to="0" class="active" aria-current="true" aria-label="First slide"></li>
            <li data-bs-target="#carouselId" data-bs-slide-to="1" aria-label="Second slide"></li>
        </ol>
        <div class="carousel-inner" role="listbox">

            <!-- First Carousel Item -->
            <div class="carousel-item active">
                <img src="/Cental-1.0.0/img/carousel-2.jpg" class="img-fluid w-100" alt="First slide" />
                <div class="carousel-caption">
                    <div class="container py-4">
                        <div class="row g-5">

                            <div class="col-lg-6 fadeInLeft animated" data-animation="fadeInLeft" data-delay="1s" style="animation-delay: 1s;">
                                <div class="bg-secondary rounded p-5">
                                    <h4 class="text-white mb-4">CONTINUE CAR RESERVATION</h4>
                                    <form method="post" action="@Url.Action("Search", "Booking")">
                                        <div class="row g-3">

                                            <!-- Car Type -->
                                            <div class="col-12">
                                                <select name="CarId" class="form-select" aria-label="Select Car Type">
                                                    <option value="0">Select Your Car type</option>
                                                    @foreach (var car in Model.Cars.GroupBy(c => c.Brand).Select(g => g.First()))
                                                    {
                                                        <option value="@car.CarId">@car.Brand</option>
                                                    }
                                                </select>
                                            </div>

                                            <!-- Pick Up Dropdown -->
                                            <div class="col-6">
                                                <select name="PickUpLocation" class="form-select" id="pickUpSelect" aria-label="Pick Up">
                                                    <option value="">Select Pick Up Location</option>
                                                    @foreach (var distance in Model.Distances.Select(d => d.From).Distinct())
                                                    {
                                                        <option value="@distance">@distance</option>
                                                    }
                                                </select>
                                            </div>

                                            <!-- Drop Off Dropdown -->
                                            <div class="col-6">
                                                <select name="DropOffLocation" class="form-select" id="dropOffSelect" aria-label="Drop Off">
                                                    <option value="">Select Drop Off Location</option>
                                                    @foreach (var distance in Model.Distances.Select(d => d.Destination).Distinct())
                                                    {
                                                        <option value="@distance">@distance</option>
                                                    }
                                                </select>
                                            </div>

                                            <!-- Distance Display -->
                                            <div class="col-12">
                                                <div class="form-control bg-light" id="distanceDisplay" style="min-height: 38px; display: flex; align-items: center; padding: 0.375rem 0.75rem;">
                                                    <span class="text-muted">Distance will be calculated automatically</span>
                                                </div>
                                            </div>

                                            <!-- Drop-off Link -->
                                            <div class="col-6">
                                                <a href="#" class="text-start text-white d-block mb-2">Need a different drop-off location?</a>
                                            </div>

                                            <!-- Airport Dropdown -->
                                            <div class="col-12">
                                                <select name="AirportId" class="form-select" aria-label="Select Airport">
                                                    <option value="0">Select Airport</option>
                                                    @foreach (var airport in Model.Airports)
                                                    {
                                                        <option value="@airport.AirPortId">@airport.AirportName</option>
                                                    }
                                                </select>
                                            </div>

                                            <!-- Pick Up Date -->
                                            <div class="col-6">
                                                <label class="text-white">Pick Up Date</label>
                                                <input name="PickUpDate" class="form-control" type="date" aria-label="Pick Up Date" required>
                                            </div>

                                            <!-- Drop Off Date -->
                                            <div class="col-6">
                                                <label class="text-white">Drop Off Date</label>
                                                <input name="DropOffDate" class="form-control" type="date" aria-label="Drop Off Date" required>
                                            </div>

                                            <!-- Book Now Button -->
                                            <div class="col-12">
                                                <button type="submit" class="btn btn-light w-100 py-2">Search Available Cars</button>
                                            </div>


                                        </div>
                                    </form>
                                </div>
                            </div>

                            <!-- Carousel Text -->
                            <div class="col-lg-6 d-none d-lg-flex fadeInRight animated" data-animation="fadeInRight" data-delay="1s" style="animation-delay: 1s;">
                                <div class="text-start">
                                    <h1 class="display-5 text-white">Get 15% off your rental Plan your trip now</h1>
                                    <p>Treat yourself in USA</p>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

            <!-- Second Carousel Item (Updated to match the first) -->
            <div class="carousel-item">
                <img src="/Cental-1.0.0/img/carousel-1.jpg" class="img-fluid w-100" alt="Second slide" />
                <div class="carousel-caption">
                    <div class="container py-4">
                        <div class="row g-5">

                            <div class="col-lg-6 fadeInLeft animated" data-animation="fadeInLeft" data-delay="1s" style="animation-delay: 1s;">
                                <div class="bg-secondary rounded p-5">
                                    <h4 class="text-white mb-4">CONTINUE CAR RESERVATION</h4>
                                    <form>
                                        <div class="row g-3">

                                            <!-- Car Type -->
                                            <div class="col-12">
                                                <select class="form-select" aria-label="Select Car Type">
                                                    <option selected>Select Your Car type</option>
                                                    @foreach (var car in Model.Cars)
                                                    {
                                                        <option value="@car.CarId">@car.Brand @car.Model</option>
                                                    }
                                                </select>
                                            </div>

                                            <!-- Pick Up Dropdown -->
                                            <div class="col-6">
                                                <select class="form-select" id="pickUpSelect2" aria-label="Pick Up">
                                                    <option selected>Select Pick Up Location</option>
                                                    @foreach (var distance in Model.Distances.Select(d => d.From).Distinct())
                                                    {
                                                        <option value="@distance">@distance</option>
                                                    }
                                                </select>
                                            </div>

                                            <!-- Drop Off Dropdown -->
                                            <div class="col-6">
                                                <select class="form-select" id="dropOffSelect2" aria-label="Drop Off">
                                                    <option selected>Select Drop Off Location</option>
                                                    @foreach (var distance in Model.Distances.Select(d => d.Destination).Distinct())
                                                    {
                                                        <option value="@distance">@distance</option>
                                                    }
                                                </select>
                                            </div>

                                            <!-- Distance Display -->
                                            <div class="col-12">
                                                <div class="form-control bg-light" id="distanceDisplay2" style="min-height: 38px; display: flex; align-items: center; padding: 0.375rem 0.75rem;">
                                                    <span class="text-muted">Distance will be calculated automatically</span>
                                                </div>
                                            </div>

                                            <!-- Drop-off Link -->
                                            <div class="col-6">
                                                <a href="#" class="text-start text-white d-block mb-2">Need a different drop-off location?</a>
                                            </div>

                                            <!-- Airport Dropdown -->
                                            <div class="col-12">
                                                <select class="form-select" aria-label="Select Airport">
                                                    <option selected>Select Airport</option>
                                                    @foreach (var airport in Model.Airports)
                                                    {
                                                        <option value="@airport.AirPortId">@airport.AirportName</option>
                                                    }
                                                </select>
                                            </div>

                                            <!-- Pick Up Date -->
                                            <div class="col-6">
                                                <label class="text-white">Pick Up Date</label>
                                                <input class="form-control" type="date" aria-label="Pick Up Date">
                                            </div>

                                            <!-- Drop Off Date -->
                                            <div class="col-6">
                                                <label class="text-white">Drop Off Date</label>
                                                <input class="form-control" type="date" aria-label="Drop Off Date">
                                            </div>

                                            <!-- Book Now Button -->
                                            <div class="col-12">
                                                <button type="submit" class="btn btn-light w-100 py-2">Search Available Cars</button>
                                            </div>

                                        </div>
                                    </form>
                                </div>
                            </div>

                            <!-- Carousel Text -->
                            <div class="col-lg-6 d-none d-lg-flex fadeInRight animated" data-animation="fadeInRight" data-delay="1s" style="animation-delay: 1s;">
                                <div class="text-start">
                                    <h1 class="display-5 text-white">Get 15% off your rental Plan your trip now</h1>
                                    <p>Treat yourself in USA</p>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
    // jQuery yüklendikten sonra çalışacak fonksiyon
    function initializeCarouselDistance() {
        if (typeof $ === 'undefined') {
            console.log('jQuery not loaded yet, waiting...');
            setTimeout(initializeCarouselDistance, 100);
            return;
        }
        
        console.log('CarouselComponentPartial JavaScript loaded');

        function calculateDistance(fromLocation, toLocation, targetDisplayId) {
            console.log('Calculating distance:', fromLocation, '->', toLocation);
            
            if (!fromLocation || !toLocation) {
                console.log('Both locations must be selected');
                return;
            }

            // Distance verilerini model'den al
            var distances = @Html.Raw(Json.Serialize(Model.Distances));
            console.log('Available distances:', distances);
            console.log('Looking for:', fromLocation, 'to', toLocation);
            
            // Her distance objesini kontrol et
            distances.forEach(function(d, index) {
                console.log('Distance ' + index + ':', d);
            });
            
            // Mesafeyi bul (property isimleri camelCase olur)
            var distance = distances.find(d => {
                console.log('Checking:', d.from, 'vs', fromLocation, 'and', d.destination, 'vs', toLocation);
                return (d.from === fromLocation && d.destination === toLocation) ||
                       (d.from === toLocation && d.destination === fromLocation);
            });
            
            var $display = $(targetDisplayId);
            
            if (distance) {
                console.log('Distance object found:', distance);
                $display.html('<span class="text-success fw-bold">Distance: ' + distance.distanceValue + ' km</span>');
                console.log('Distance found:', distance.distanceValue, 'km');
            } else {
                $display.html('<span class="text-warning">Distance not available</span>');
                console.log('Distance not found between:', fromLocation, 'and', toLocation);
            }
        }

        // Event handlers for first carousel
        $('#pickUpSelect, #dropOffSelect').change(function() {
            var fromLocation = $('#pickUpSelect').val();
            var toLocation = $('#dropOffSelect').val();
            
            console.log('Location changed - From:', fromLocation, 'To:', toLocation);
            
            if (fromLocation && toLocation && fromLocation !== '' && toLocation !== '') {
                calculateDistance(fromLocation, toLocation, '#distanceDisplay');
            }
        });
        
        // Event handlers for second carousel
        $('#pickUpSelect2, #dropOffSelect2').change(function() {
            var fromLocation = $('#pickUpSelect2').val();
            var toLocation = $('#dropOffSelect2').val();
            
            console.log('Location 2 changed - From:', fromLocation, 'To:', toLocation);
            
            if (fromLocation && toLocation && fromLocation !== '' && toLocation !== '') {
                calculateDistance(fromLocation, toLocation, '#distanceDisplay2');
            }
        });
        
        // Form validation
        $('form').on('submit', function(e) {
            var carId = $(this).find('select[name="CarId"]').val();
            var pickUpLocation = $(this).find('select[name="PickUpLocation"]').val();
            var dropOffLocation = $(this).find('select[name="DropOffLocation"]').val();
            var pickUpDate = $(this).find('input[name="PickUpDate"]').val();
            var dropOffDate = $(this).find('input[name="DropOffDate"]').val();
            
            if (!pickUpLocation || !dropOffLocation || !pickUpDate || !dropOffDate) {
                e.preventDefault();
                alert('Please fill in all required fields (Pick Up Location, Drop Off Location, Pick Up Date, Drop Off Date)');
                return false;
            }
            
            if (new Date(pickUpDate) >= new Date(dropOffDate)) {
                e.preventDefault();
                alert('Drop Off Date must be after Pick Up Date');
                return false;
            }
            
            console.log('Form submitted with:', {
                carId: carId,
                pickUpLocation: pickUpLocation,
                dropOffLocation: dropOffLocation,
                pickUpDate: pickUpDate,
                dropOffDate: dropOffDate
            });
        });
    }
    
    // Sayfa yüklendiğinde başlat
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeCarouselDistance);
    } else {
        initializeCarouselDistance();
    }
</script>
